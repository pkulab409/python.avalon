# 《图灵阿瓦隆-Tuvalon》

## 基于游戏《阿瓦隆》的延伸作品<span style="font-size: smaller;">`pkudsa.avalon`</span>

- 2025年春季数算B课程大作业

---

## 🔗参考游戏《阿瓦隆》玩法链接

- [桌游《阿瓦隆(Avalon)》教学教程 完全指南](https://zhuanlan.zhihu.com/p/685062276)

- [卡牌《阿瓦隆》攻略](https://zhuanlan.zhihu.com/p/546211143)

- [不思议阿瓦隆攻略，阿瓦隆游戏攻略大全](https://www.youfanx.com/gonglue/202405/467216.html)

---

## 🌆背景故事

在卡姆兰的战场上，莫德雷德一剑刺入了亚瑟王的心脏。王的瞳孔逐渐涣散，战场上的风呼啸，我们的王，倒下了。

鲜血染红了亚瑟王的盔甲，那致命的一剑，砍碎了众人心中坚定的信仰，让曾经辉煌的圆桌骑士们陷入了绝望。

大魔法师梅林有着整个王国最渊博的学识、最智慧的头脑，面对此等危难时刻，他即刻反应过来，使用魔法号召还尚存斗志的骑士们。

“我们必须去阿瓦隆！”大魔法师梅林的声音在战场上回荡，“那里有治愈一切的力量，亚瑟王还有救！”

派西维尔，那位忠诚的骑士，立刻响应：“我愿意前往，为了我们的王！”

听到派西维尔振奋人心的呐喊，更多的骑士重拾他们的信仰与利剑，他们的眼中充满了对亚瑟王的敬意和对使命的执着，拼死与莫德雷德的爪牙们战斗着，掩护着梅林等人的撤退。

梅林领着六人各自伪装，借着骑士们的掩护，带着亚瑟王的遗体，踏上了前往阿瓦隆的路。

然而没过多久，梅林就敏锐地察觉到了异样，他所带着的六人并非全是忠于亚瑟王的骑士！他动用魔法感知到这支七人队里混入了三名莫德雷德的手下！

前往阿瓦隆会经过一条需要魔法的航道，梅林知道自己不能死，否则将没人为船只领航！

梅林不敢轻举妄动，更不能坐以待毙。最终，他决定赌一把，用魔法操纵亚瑟王的遗体说话：“诸位，我是梅林，我们七人中混入了三个不速之客，他们或将阻碍我们复活亚瑟王的神圣使命。我提议，我们不要卸下伪装，相互监视，逐步排除异己。愿亚瑟王与你同在，May King Arthur be with you！”

---

## 📢七人局《图灵阿瓦隆-Tuvalon》游戏规则

### 一、概述

一局游戏共7名玩家，分为两大阵营：**<span style="color: blue">【骑士】（蓝方）</span>**、**<span style="color: red">【反抗军】（红方）</span>**。

在游戏正式开始前的【夜晚】，所有玩家获知自己的角色及相应视角的信息。不同的角色有不同的视角，获得的信息是不相同的。

游戏将在一个**9×9**的地图上进行，所有玩家的位置始终为公开信息。

游戏过程中会进行至多五次【任务】。每轮任务流程如下：
1. 由一名【队长】提名若干名【队员】执行任务；
2. 所有玩家进行【第一次讨论】，所有讨论内容全图广播；
3. 随后，每位玩家可在地图上**移动3步**；
4. 进行【第二次讨论】，玩家仅能听见**自身听力范围内**的玩家发言；
5. 所有玩家进行【公开投票】决定是否执行任务；
6. 任务执行完毕后，队员将进行【匿名投票】，决定任务成功与否。

【骑士】（蓝方）要确保任务成功**且**保护【梅林】，【反抗军】（红方）要破坏任务**或**找出【梅林】，将其【刺杀】。

若一轮【任务】成功**记蓝色阵营胜利1次**，失败**记红色阵营胜利1次**。整局游戏的胜负判定采取五局三胜制：先累积胜利3次的阵营，若为【反抗军】（红方），则**立即**宣告最终获胜；若为【骑士】（蓝方），则视为**即将**最终获胜，此时红方刺客可以尝试刺杀梅林，若【刺杀成功】则**红方立即宣告最终获胜**，若【刺杀失败】则**蓝方立即宣告最终获胜**。

因此，两个阵营都要积极参与进每次任务中。
蓝方要识别并排除潜在的红方成员，从而避免低成功率的任务执行，并确保队伍中成员可靠，从而让执行的任务成功完成。
红方则要隐藏自己的真实身份，避免引起怀疑；同时尽可能混入执行队伍，在关键任务中投出失败票，破坏任务，悄无声息地推进红方的胜利条件。


### 二、阵营与角色

每局游戏中，七名玩家将扮演以下六种角色：

- **骑士阵营（蓝方）**  
  - **胜利目标**：使三轮任务成功。
  - **角色能力**：
    - **【梅林】 (Merlin)**：夜晚阶段可查看所有红方玩家（为统一代码我们弃用了Loyal Coutier这一名称）。
    - **【派西维尔】 (Percival)**：夜晚阶段只能看到【梅林】和【莫甘娜】，**且无法区分两者**。
    - **【骑士】 (Knight)**：有更广的听力范围。夜晚阶段无法查看任何人，也无法被任何人看到。

- **反抗军阵营（红方）**
  - **胜利目标**：使三轮任务失败，或在蓝方即将胜利时通过刺杀【梅林】反败为胜。
  - **角色能力**：
    - **【莫甘娜】 (Morgana)**：假扮【梅林】，夜晚阶段与除【奥伯伦】外的所有红方玩家互认。
    - **【刺客】 (Assassin)**：夜晚阶段与除【奥伯伦】外的所有红方玩家互认。在蓝方三轮任务成功，即将胜利时，可刺杀【梅林】，刺杀成功则红方反败为胜。
    - **【奥伯伦】 (Oberon)**：有更广的听力范围，红方独狼。夜晚阶段无法查看任何人，也无法被其他红方玩家看到。

**除【骑士】有2人外，其他角色有且只有1人。**  

### 三、游戏进程

**总体流程**：【夜晚】 → 【任务1】 → 【任务2】 → 【任务3】，视情况进行【任务4】【任务5】【刺杀】

![process](https://git.pku3d.com/chenbin/pkudsa.avalon/media/branch/master/static/images/process.png)

#### 1. **初始阶段**
- 每名玩家获得自己的编号。
- 每名玩家获得自己的角色。

#### 2. **【夜晚】阶段**
1. **红方（除【奥伯伦】）互认**：【莫甘娜】、【刺客】睁眼确认队友。
2. **【梅林】睁眼**：查看所有红方玩家。
3. **【派西维尔】睁眼**：查看【梅林】和【莫甘娜】（但无法区分）。

#### 3. **【任务】流程（至多循环5轮）**

![mission](https://git.pku3d.com/chenbin/pkudsa.avalon/media/branch/master/static/images/mission.png)

1. **队长组队**  
   - 首轮【队长】固定为1号玩家。后续任务的【队长】按编号顺序递增。
   - 当前轮次的【队长】按当前轮次要求提名【队员】（如第1轮选2人）。
   - 可自由选择是否包含自己。  
   - **每轮【队员】人数**（七人局）：
     | 轮次 | 【任务1】 | 【任务2】 | 【任务3】（保护性） | 【任务4】（保护性） | 【任务5】 |  
     |------|-------|-------|-------|----------------|-------|  
     | 人数 | 2人   | 3人   | 3人   | 4人           | 4人   |  

2. **第一轮发言（全图广播）**  
   - 从队长开始，所有玩家按编号顺序进行发言。
   - 发言内容全图广播。
   
3. **玩家移动**
   - 所有玩家在大小为9×9的地图上移动，每次最多移动3步。
   - 从队长开始，所有玩家按编号顺序进行移动。
   
4. **第二轮发言（有限听力范围）**  
   - 从队长开始，所有玩家按编号顺序进行发言。
   - 【梅林】【派西维尔】【莫甘娜】【刺客】只能听见以自己为中心、**3×3**的范围内的玩家的发言。而【骑士】【奥伯伦】拥有更大的听力范围，能听见以自己为中心、**5×5**的范围内的玩家的发言。
     

![views](https://git.pku3d.com/chenbin/pkudsa.avalon/media/branch/master/static/images/views.png)

5. **公投表决**  
   - 所有玩家**同时**对于是否【执行】本次任务进行投票（支持/反对）。**投票结果公开。**
   - **通过条件**：支持票过半（≥4）→ 【执行】任务。
   - **否决条件**：反对票过半（≥4）→ 【不执行】任务，顺时针更换【队长】重新选择【队员】（转到1）。
   - **【特殊情况】连续三次否决**：由第四次组队的【队长】直接选定【队员】，不经公投表决强制【执行】任务。

6. **任务执行**  
   - 所有【队员】将进行一次**匿名**投票，决定任务的成功与否。蓝方队员只能投【成功票】，即只能支持任务成功；红方队员可自主选择投【成功票】暂时隐藏自己的身份，或者【失败票】直接破坏本轮任务。
   - **玩家只能看到最后任务成功或否，不能看到具体投票情况。**
   - **任务结果判定**：  
     - 【任务1】【任务2】【任务5】中，【失败票】数量大于等于1，则任务失败，否则任务成功。
     - 【任务3】、【任务4】为保护轮，【失败票】数量大于等于2，则任务失败，否则任务成功。

7. **刺杀**
   - 当有三次【任务】成功，蓝方即将获胜时，【刺客】可以亮明身份，进行独立思考后选择杀死一名玩家。若成功杀死【梅林】，则红方反败为胜；否则蓝方依然获胜。

### 四、【游戏结束】与单局游戏的胜负判定

#### 1. **蓝方胜利条件**
- 累计三轮【任务】成功，且【刺客】刺杀【梅林】失败。

#### 2. **红方胜利条件**
- 累计三轮【任务】失败；
- 或蓝方达成三轮【任务】成功后，【刺客】成功刺杀【梅林】。

#### 3. **游戏非正常结束的条件及胜负判定**
- **游戏中，某玩家的算法出现bug或超时/超token等犯规行为**——游戏立即结束，该玩家判负，其余玩家记为平手。

---

## 💡各小组成员需要做什么

- 编写程序，使得自己的程序能够胜任《阿瓦隆》游戏玩家的角色！

- 在自己的程序中找到合适时机调用大语言模型（LLM）来进行判断其他玩家的发言、组织自己的发言以及辅助决策等操作！

---

## ✅对各小组程序的评价机制（未完待续……）

### 一、竞赛分

我们使用 **ELO 机制** 来衡量代码水平。

ELO 机制是一种用于评估玩家竞技水平的动态评分系统，现广泛应用于电竞、体育联赛等场景。玩家通过胜负获得或失去分数，调整幅度取决于双方赛前评分差距。若高分玩家击败低分玩家，得分较少；反之低分玩家若爆冷获胜则得分更多。  

请参阅 [ELO 规则](./elo) 。

**转化成最终的分数**：
通过天梯排名、[预选赛](#预选赛)、[决赛](#决赛)的综合表现得出。具体计算方法：

> 🚧施工中……

### 二、算法分

AI的语言艺术、分析水平、推导能力等将体现在大作业的算法分里。

### 三、报告分

除了编写代码参加比赛之外，每个小组还需要提交一份报告

---

## 💻编写并优化代码

请按照 [代码提交指引](./code_submission_guide) 、 [服务器功能一览](./server_func) 指引，编写并优化代码。

---

## 📪赛程

### 预选赛

> 🚧施工中……

### 决赛

**时间**：6月3日，第16周的课上

> 🚧施工中……

---

## 🔗其他链接
- [AI集体破防！DeepSeek狼人杀封神之战，预判你的预判](https://www.bilibili.com/video/BV1NGN9eAECT/?share_source=copy_web)
