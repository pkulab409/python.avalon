ğŸ§­å¤§ä½œä¸šå¯¹æˆ˜å¹³å° ç”¨æˆ·æ–‡æ¡£

---

# è°ƒç”¨æœåŠ¡å™¨åŠŸèƒ½

æœåŠ¡å™¨ä¸ºå¤§å®¶æä¾›äº†è¾…åŠ© API å·¥å…·åŒ…ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ [æŒ‡å¯¼](./code_submission_guide.md#å¯è°ƒç”¨çš„è¾…åŠ©API) å¯¼å…¥ã€‚ä¸ºä¸åæ–‡ä¿æŒä¸€è‡´ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œé‡å¤ä¸€éå¤§å®¶æ‰€å†™çš„æ¸¸æˆä»£ç çš„ import è¿‡ç¨‹ã€‚

```python
from game.avalon_game_helper import (
    write_into_private,
    read_private_lib,
    read_public_lib,
    askLLM
)
```

## å¯¹å±€ä¸­çš„å…¬æœ‰åº“  

å¯¹å±€ä¸­ï¼Œ **å…¬æœ‰åº“ï¼ˆPublic Libraryï¼‰** æä¾›äº†å¯¹å±€ä¸­çš„å…¬å¼€ä¿¡æ¯ï¼Œè¿™å¯¹ä»£ç çš„å†³ç­–åˆ†æéå¸¸é‡è¦ã€‚

### å‡½æ•°è°ƒç”¨ç¤ºä¾‹

```python
public_records = read_public_lib()
# è¿”å›ç¤ºä¾‹ï¼š
# [
#   {"type": "game_start", "game_id": 12345, "player_count": 7, "map_size": 9},
#   {"type": "night_phase_complete"},
#   ...
# ]
```

### è¿”å›æ•°æ®æ ¼å¼è¯¦è§£

`read_public_lib()` è¿”å›ä¸€ä¸ª **Python åˆ—è¡¨**ï¼Œåˆ—è¡¨ç”±ä¸€ä¸² **Python å­—å…¸**ç»„æˆï¼Œæ¯ä¸ªå­—å…¸ä»£è¡¨ä¸€æ¡æ¸¸æˆäº‹ä»¶ã€‚

æ¯ä¸ªä»£è¡¨æ¸¸æˆäº‹ä»¶çš„å­—å…¸é‡Œï¼Œ**ä¸€å®šä¼šå‡ºç° `"type"` é”®**ã€‚å®ƒå¯¹åº”ä¸åŒçš„å€¼ï¼Œè¡¨ç¤ºä¸åŒçš„æ¸¸æˆäº‹ä»¶ç±»å‹ã€‚

`"type"` é”®å¯¹åº”çš„å€¼ä¸åŒï¼Œå­—å…¸ä¸­**ä½™ä¸‹çš„é”®å€¼å¯¹**ä¹Ÿä¸åŒã€‚`"type"` é”®å¯¹åº”çš„å€¼ä¸åç»­é”®å€¼å¯¹çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š

#### **`"game_start"`**ï¼šæ¸¸æˆå¼€å§‹
  - <span style="font-size: small;">ï¼ˆåé¢çš„é”®å€¼å¯¹è§ä¸‹ï¼Œå†’å·å‰é¢çš„å­—ç¬¦ä¸²æ˜¯é”®ï¼Œå†’å·åé¢è¡¨ç¤ºå€¼çš„æ•°æ®ç±»å‹ï¼‰</span>
  - `"game_id": int`ï¼šæ¸¸æˆå”¯ä¸€ç¼–å·
  - `"player_count": int`ï¼šç©å®¶æ€»æ•°
  - `"map_size": int`ï¼šåœ°å›¾å°ºå¯¸

#### **`"night_phase_complete"`**ï¼šå¤œæ™šé˜¶æ®µç»“æŸï¼Œæ— é¢å¤–å­—æ®µ
  - ~~ï¼ˆä½ æ€»ä¸ä¼šè®¤ä¸ºèƒ½åœ¨æ­¤å¤„å·å·æ‘¸æ‘¸åœ°æ‹¿åˆ°æ‰€æœ‰è§’è‰²çš„èº«ä»½å§ï¼Ÿï¼‰~~

#### **`"mission_start"`**ï¼šä»»åŠ¡å›åˆå¼€å§‹
  - `"round: int"`ï¼šå›åˆåºå·ï¼ˆ1~5ï¼‰
  - `"leader": int`ï¼šæœ¬å›åˆé˜Ÿé•¿ç©å®¶ID
  - `"member_count": int`

#### **`"team_proposed"`**ï¼šé˜Ÿé•¿æåå›¢é˜Ÿ
  - `"round": int`ï¼šå›åˆåºå·
  - `"vote_round": int`ï¼šæœ¬å›åˆç¬¬å‡ æ¬¡æŠ•ç¥¨
  - `"leader": int`ï¼šæåè€…ï¼ˆé˜Ÿé•¿ï¼‰ID
  - `"members": list[int]`ï¼šè¢«æåçš„ç©å®¶IDåˆ—è¡¨
  - \* ä»è¿™é‡Œå¼€å§‹ï¼Œè°ƒç”¨å…¬æœ‰åº“æ˜¾å¾—é‡è¦äº†ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œé™„ä¸Š Python ç¤ºä¾‹ï¼š

  ```python
  # å‡å¦‚ç¬¬2è½®å‘è¨€å‰ï¼Œéœ€è¦æŸ¥çœ‹ç¬¬1è½®çš„æœ€åä¸€æ¬¡é˜Ÿé•¿æåå›¢é˜Ÿä¿¡æ¯
  # å…¶ä»–ä»£ç çœç•¥â€¦â€¦
  self.cur_round = 2

  def say() -> str:
      '''å‘è¨€'''
      last_round_team = {}
      public_records = read_public_lib()
      idx = len(public_records) - 1
      while True:
          if public_records[idx]["type"] == "team_proposed" and public_records[idx]["round"] == self.cur_round - 1:
              last_round_team["leader"] = public_records[idx]["leader"]
              last_round_team["members"] = public_records[idx]["members"]
              break
          if idx < 0:  # è¯·å¤§å®¶æ³¨æ„å¼‚å¸¸å¤„ç†ï¼
              return "æˆ‘è¿˜åœ¨æ€è€ƒã€‚"
          idx -= 1
      return f"è¯·å¤§å®¶å‚è€ƒä¸Šè½®é˜Ÿä¼ä¿¡æ¯ã€‚é˜Ÿé•¿æ˜¯{last_round_team["leader"]}å·ï¼Œé˜Ÿå‘˜æ˜¯{" ".join(map(str, last_round_team["members"]))}ï¼Œå¯¹æ¯”è¿™ä¸€è½®ï¼Œè¯´æ˜â€¦â€¦"
  ```

#### **`"global_speech"`**ï¼šå…¨å›¾å¹¿æ’­å‘è¨€
  - `"round": int`ï¼šå›åˆåºå·
  - `"speeches": list[list]`ï¼šå‘è¨€åˆ—è¡¨ï¼Œæ ¼å¼ `[[player_id, text], [player_id, text], â€¦]`

#### **`"movement"`**ï¼šç©å®¶ç§»åŠ¨è®°å½•
  - `"round": int`ï¼šå›åˆåºå·
  - `"movements": list[dict]`ï¼šåˆ—è¡¨ï¼Œæ¯é¡¹æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œé”®å€¼å¯¹å¦‚ä¸‹ï¼š
    - `"player_id": int`ï¼šç§»åŠ¨çš„ç©å®¶ID
    - `"requested_moves": list[str]`ï¼šè¯·æ±‚çš„ç§»åŠ¨æ–¹å‘åˆ—è¡¨
    - `"executed_moves": list[str]`ï¼šå®é™…æ‰§è¡Œçš„ç§»åŠ¨åˆ—è¡¨
    - `"final_position": list[int]`ï¼šæœ€ç»ˆåæ ‡ `[x, y]`

#### **`limited_speech`**ï¼šæœ‰å¬åŠ›èŒƒå›´é™åˆ¶çš„å‘è¨€
  - `"round": int`ï¼šå›åˆåºå·

#### **`"public_vote"`**ï¼šå…¬æŠ•è¡¨å†³
  - `"round": int`ï¼šå›åˆåºå·
  - `"votes": dict`ï¼šå­—å…¸ï¼Œé”®ä¸ºç©å®¶IDï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰ï¼Œå€¼ä¸º `True`/`False`
  - `"approve_count": int`ï¼šèµæˆç¥¨æ•°
  - `"result": str`ï¼šç»“æœå­—ç¬¦ä¸²ï¼Œå¯èƒ½ä¸º `"approved"`ã€`"rejected"`

#### **`"team_rejected"`**ï¼šå›¢é˜Ÿè¢«å¦å†³
  - `"round": int`ï¼šå›åˆåºå·
  - `"vote_round": int`ï¼šæœ¬å›åˆç¬¬å‡ æ¬¡æŠ•ç¥¨
  - `"approve_count": int`ï¼šå½“æ¬¡èµæˆç¥¨æ•°
  - `"next_leader": int`ï¼šä¸‹ä¸€ä¸ªé˜Ÿé•¿ç©å®¶ID

#### **`"consecutive_rejections"`**ï¼šè¿ç»­å¦å†³è§¦å‘å¼ºåˆ¶ç»„é˜Ÿ
  - `"round": int`ï¼šå›åˆåºå·

#### **`"mission_execution"`**ï¼šä»»åŠ¡æ‰§è¡Œ
  - `"round": int`ï¼šå›åˆåºå·
  - `"fail_votes": int`ï¼šå¤±è´¥ç¥¨æ•°
  - `"success": bool`ï¼šå¸ƒå°”ï¼Œ`True` è¡¨ç¤ºä»»åŠ¡æˆåŠŸ

#### **`"mission_result"`**ï¼šä»»åŠ¡ç»“æœæ€»ç»“
  - `"round":int`ï¼šå›åˆåºå·
  - `"result": str`ï¼š`"success"` æˆ– `"fail"`
  - `"blue_wins": int`ï¼šç›®å‰ä¸ºæ­¢ï¼Œè“æ–¹èƒœåˆ©è½®æ•°
  - `"red_wins": int`ï¼šç›®å‰ä¸ºæ­¢ï¼Œçº¢æ–¹èƒœåˆ©è½®æ•°

#### **`"assassination"`**ï¼šåˆºæ€é˜¶æ®µ
  - `"assassin": int`ï¼šåˆºå®¢ç©å®¶ID
  - `"target": int`ï¼šç›®æ ‡ç©å®¶ID
  - `"target_role": str`ï¼šç›®æ ‡è§’è‰²åç§°ï¼ˆå…¬å¼€ï¼‰
  - `"success": bool`ï¼šå¸ƒå°”ï¼Œæ˜¯å¦åˆºæ€æˆåŠŸ

#### **`"game_end"`**ï¼šæ¸¸æˆç»“æŸ
  - `"result": dict`ï¼šå­—å…¸ï¼ŒåŒ…å«ä»¥ä¸‹é”®å€¼å¯¹ï¼š
    - `"blue_wins": int`ã€`"red_wins": int`ï¼ˆè½®æ•°ï¼‰
    - `"rounds_played": int`ï¼ˆæ€»å›åˆæ•°ï¼‰
    - `"roles": dict`ï¼šç©å®¶è§’è‰²æ˜ å°„ `{player_id: role}`
    - `"public_log_file": str`ï¼šå®Œæ•´æ—¥å¿—æ–‡ä»¶è·¯å¾„
    - `"winner": str`ï¼š`"blue"` æˆ– `"red"`
    - `"win_reason": str`ï¼šè·èƒœåŸå› ï¼Œå¦‚ `"assassination_success"`

---

## å¯¹å±€ä¸­çš„ç§æœ‰åº“

å¯¹å±€ä¸­ï¼Œä¸€äº›ç§äººçš„â€œå°å¿ƒæ€â€å¯ä»¥æ”¾åœ¨ **ç§æœ‰åº“ï¼ˆPrivate Libraryï¼‰** ä¸­ï¼Œå¢åŠ æ•ˆç‡ã€‚

- **å†™å…¥ç§æœ‰åº“**ï¼š\

  - å¯ä»¥é€šè¿‡ä¸‹é¢ä»£ç å°†ä»»æ„å­—ç¬¦ä¸²å†™å…¥ç§æœ‰åº“ä¸­ã€‚

  ```python
  write_into_private("1å·ç©å®¶åŠ¨æœºä¸çº¯ã€‚")
  write_into_private("3å·ç©å®¶åŠ¨æœºä¸çº¯ã€‚")
  ```

  - `write_into_private` å‡½æ•°è¢«æ‰§è¡Œä¹‹åï¼ŒæœåŠ¡å™¨ä¼šå°†æ‚¨æ‰€è¾“å…¥çš„å­—ç¬¦ä¸²è´´ä¸Šæ—¶é—´æˆ³ä¹‹åå­˜å‚¨åˆ°ç§æœ‰åº“ä¸­ã€‚

- **è¯»å–ç§æœ‰åº“**ï¼š

  - å¯ä»¥é€šè¿‡ä¸‹é¢ä»£ç è¯»å–ç§æœ‰åº“çš„æ‰€æœ‰å†…å®¹ã€‚

  ```python
  private_data = read_private_lib()  # è¿”å›ä¸€ä¸ªå­—å…¸åˆ—è¡¨ï¼Œæ¯ä¸ªå­—å…¸è¡¨ç¤ºä¸€æ¡è®°å½•ã€‚
  # è¿”å›ç¤ºä¾‹ï¼š
  # [
  #     {
  #       "timestamp": 1745396437.1877804,
  #       "content": "1å·ç©å®¶åŠ¨æœºä¸çº¯ã€‚"
  #     },
  #     {
  #       "timestamp": 1745396438.1877804,
  #       "content": "3å·ç©å®¶åŠ¨æœºä¸çº¯ã€‚"
  #     },
  # ]
  ```

---

## å¤§è¯­è¨€æ¨¡å‹API

**æ³¨æ„ï¼šæˆ‘ä»¬å¯¹å¤§è¯­è¨€æ¨¡å‹åšå‡ºäº† token è°ƒç”¨é™åˆ¶ï¼Œä»¥é˜²æ­¢ç¨‹åºå¯¹å¤§è¯­è¨€æ¨¡å‹çš„è¿‡åº¦ä¾èµ–ã€‚**

**å…·ä½“é™åˆ¶ç­–ç•¥ï¼š**

1. **ä¸€æ¬¡è¾“å…¥/è¾“å‡ºé™åˆ¶**

  - è¾“å…¥æç¤ºï¼ˆ`prompt`ï¼‰é•¿åº¦æœ€å¤š **500 tokens** 

  - llmè¾“å‡ºå“åº”è‡ªåŠ¨æˆªæ–­è‡³ **500 tokens** 

2. **æ€»è¾“å…¥/è¾“å‡ºé™åˆ¶**

  - $è¾“å…¥é•¿åº¦ \times \frac{1}{4} + è¾“å‡ºé•¿åº¦ \times \frac{3}{4}$ ä¸èƒ½è¶…è¿‡ **3000**

  - å¦‚æœè¶…å‡º 3000ä¸ä¼šæŠ¥é”™ï¼Œä½†ä¼šç»™äºˆä¸€å®šçš„ **ELO åˆ†æ•°æƒ©ç½š**